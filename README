Эксперимент как получить пул-воркеров, для которого точно известно занят воркер или нет.

Общая идея:

1) Добавляется тред диспетчер, т.к. выдача задания воркеру и проверка свободности должны проходить в одном треде во избежании гонки данных.

2) Каждый воркер имеет эксклюзивный канал с диспетчером.

3) По эксклюзивному каналу передается уникальная для этого канала структура-слот, содержащая задание.

4) Пустые слоты возвращаются диспетчеру по общему для всех воркеров каналу.

Оверхед минимум в два раза: (recv) заменяется на (send + recv + send + recv)

Плюс может быть оверхед на логику диспетчера.




В простом эксперименте slot-channel получается в 2.5 раза медленнее unbounded channel.

По все еще существенно быстро (локальный тест на ноуте):

[main] tasking slot-channel: 83ns
[main] DONE slot-channel: 3.0982155s (3227664.441 per sec)

[main] tasking one channel: 42ns
[main] DONE one-channel: 1.212657042s (8246354.619 per sec)

Т.е. три млн сообщений в секунду

P.S. Можно еще поразвлекаться с хранением индексов внутри слота, чтобы не копировать указатели, но выигрыш не будет принципиальным. 
